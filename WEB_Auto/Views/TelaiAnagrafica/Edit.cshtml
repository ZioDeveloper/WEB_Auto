@model WEB_Auto.Models.HomeModel
@{
    ViewBag.Title = "Dati Perizia";
}
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/css/bootstrap-select.min.css">

<!-- Latest compiled and minified JavaScript -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/js/bootstrap-select.min.js"></script>

<style>
    table, td, th {
        border: 0;
    }

    table {
        border-collapse: collapse;
        width: 100%;
    }

    th {
        height: 20px;
    }
</style>

<details >
    <summary style="color:navy">Info generali su spedizione...</summary>
    <div class="jumbotron">

        <div>
            @{var item1 = Model.AGR_SpedizioniWEB_Decoded_vw.ToList();}
            @{var item2 = Model.AGR_TipiPerizia.ToList();}
            @{var item3 = Model.AGR_Meteo.ToList();}
            @{var item4 = Model.AGR_Perizie_MVC_Flat_vw.ToList();}

            @*@Html.Label("Spedizione :") &nbsp;  @Html.Label(item1[0].ID)*@
            <table>
                <tr>
                    <td>
                        @Html.Label("Spedizione : ")
                    </td>
                    <td>
                        @Html.Label(item1[0].ID)
                    </td>
                    <td>&nbsp;&nbsp;</td>


                </tr>
                <tr>
                    <td>
                        @Html.Label("Viaggio : ")
                    </td>
                    <td>
                        @Html.Label(item1[0].IDOriginale1)
                    </td>
                    @*<td>&nbsp;&nbsp;</td>*@
                </tr>
                <tr>
                    <td>
                        @Html.Label("Del : ")
                    </td>
                    <td>
                        @Html.Label(item1[0].DataInizioImbarco.ToString().Substring(0, 10))
                    </td>
                </tr>
                <tr>
                    <td>
                        @Html.Label("POL : ")
                    </td>
                    <td>
                        @Html.Label(item1[0].IDPortoImbarco + " -" + item1[0].POL)
                    </td>
                </tr>
                <tr>

                    <td>
                        @Html.Label("POD : ")
                    </td>
                    <td>
                        @Html.Label(item1[0].IDPortoSbarco + " -" + item1[0].POD)
                    </td>
                </tr>
                <tr>
                    <td>
                        @Html.Label("Nave : ")
                    </td>
                    <td>
                        @Html.Label(item1[0].IDNave + " -" + item1[0].Nave)
                    </td>
                    @*<td>&nbsp;&nbsp;</td>*@
                </tr>
                <tr>
                    <td>
                        @Html.Label("Casa costruttrice : ")
                    </td>
                    <td>
                        @Html.Label(item1[0].IDCasa + " -" + item1[0].Casa)
                    </td>
                </tr>
                <tr>
                    <td>
                        @Html.Label("Tipo perizia : ")
                    </td>
                    <td>
                        @Html.Label(item2[0].ID + " - " + item2[0].DescrITA)
                    </td>
                </tr>
            </table>

        </div>
    </div>
</details>
<br />
@if (ViewBag.ErrMess == "Sbloccato")
{
    <div style="color:green">
        Controllo OK ! 
    </div>
}
else
{
    <div style="color:red">
        @ViewBag.ErrMess 
    </div>
}
<br />
<div>
    @using (Html.BeginForm("SalvaPeriziaTesta", "TelaiAnagrafica", new
    {
        IDPerito = item4[0].IDPerito,
        IDSpedizione = item4[0].IDSpedizione,
        IDMeteo = @item3[0].ID,
        IDTP = item2[0].ID,
        myIDPerizia = item4[0].ID
    }, FormMethod.Post))
    {


    <table>
        <tr>
            <td>
                @Html.Label("Viaggio")
            </td>
            <td>
                @Html.DropDownList("IDSpedizione", new SelectList((SelectList)ViewData["ElencoSpedizioni"], "Value", "Text", ViewBag.IDSpedizione), "-- Seleziona spedizione --", new { @class = "form-control selectpicker data-live-search=true", @*@onchange = "submitform();"*@ })
            </td>
        </tr>
        <tr>
            <td>
                @Html.Label("Inspection date")
            </td>
            <td>
                @Html.TextBox("DataPerizia", DateTime.Now.ToString("dd/MM/yyyy"), new { @readonly = "readonly", style = "background:lightgrey" })
            </td>
        </tr>
        <tr>
            <td>
                &nbsp;
            </td>
        </tr>
        <tr>
            <td>
                @Html.Label("Chassis")
            </td>
            <td>
                @Html.TextBox("Chassis", item4[0].Telaio, new { onkeyup = "InputToUpper(this);" })
            </td>
        </tr>
        <tr>
            <td>
                &nbsp;
            </td>
        </tr>
        <tr>
            <td>
                @Html.Label("Seleziona modello auto")

            </td>
            <td>
                @Html.DropDownList("IDModelloCasa", new SelectList((SelectList)ViewData["ElencoModelli"], "Value", "Text", ViewBag.aIDModelloCasa), "-- Seleziona modello --", new { @class = "form-control selectpicker data-live-search=true", @onchange = "submitform();" })

            </td>
        </tr>
        @*<tr>
            <td>
                &nbsp;
            </td>
        </tr>*@
        @if (item1[0].IDCasa.ToUpper() == "RTB" || (item4[0].IDModello.ToString() == "1240" && ViewBag.aIDModelloCasa == "") || ViewBag.aIDModelloCasa == "1240" || ViewBag.aIDModelloCasa == "1241")
        {
            <tr>
                <td>
                    @Html.Label("Seleziona Trasportatore")

                </td>
                <td>
                    @Html.DropDownList("IDTrasportatoreGrim", new SelectList((SelectList)ViewData["ElencoTraspGrim"], "Value", "Text", ViewBag.aIDTrasportatore), "-- Seleziona trasportatore --", new { @class = "form-control selectpicker data-live-search=true", @onchange = "submitform();" })
                </td>
            </tr>
            @*<tr>
                <td>
                    &nbsp;
                </td>
            </tr>*@
            <tr>
                <td>
                    @Html.Label("Seleziona tipo rotabile")

                </td>
                <td>
                    @Html.DropDownList("IDTipoRotabile", new SelectList((SelectList)ViewData["ElencoTipoRotabile"], "Value", "Text", ViewBag.aIDTipoRotabile), "-- Seleziona tipo rotabile --", new { @class = "form-control selectpicker data-live-search=true", @onchange = "submitform();" })

                </td>
            </tr>
        }
        @*<tr>
            <td>
                &nbsp;
            </td>
        </tr>*@

        <tr>
            <td>
                @Html.Label("Condizione")

            </td>
            @if (item1[0].IDCasa.ToUpper() != "RTB" && (item4[0].IDModello.ToString() != "1240") || (item4[0].IDModello.ToString() == "1240" && ViewBag.aIDModelloCasa != "1240"))
            {
                if (item4[0].FlgNuovoUsato == "N")
                {
                    <td>
                        Nuovo:   @Html.RadioButton("Condizione", "N", new { @checked = true, @onchange = "submitform();" })
                        Usato: @Html.RadioButton("Condizione", "U")
                        @*@Html.RadioButtonFor(model => item4[0].FlagControllo, "Test", new { @checked = true })*@
                    </td>
                }
                else if (item4[0].FlgNuovoUsato == "U")
                {
                    <td>
                        Nuovo:   @Html.RadioButton("Condizione", "N")
                        Usato: @Html.RadioButton("Condizione", "U", new { @checked = true, @onchange = "submitform();" })
                        @*@Html.RadioButtonFor(model => item4[0].FlagControllo, "Test", new { @checked = true })*@
                    </td>
                }
                else
                {
                    <td>
                        Nuovo:   @Html.RadioButton("Condizione", "N", new { @onchange = "submitform();" })
                        Usato: @Html.RadioButton("Condizione", "U", new { @onchange = "submitform();" })
                        @*@Html.RadioButtonFor(model => item4[0].FlagControllo, "Test", new { @checked = true })*@
                    </td>
                }
            }
            else
            {
                <td>
                    Nuovo:   @Html.RadioButton("Condizione", "N", new { disabled = "disabled" })
                    Usato: @Html.RadioButton("Condizione", "U", new { disabled = "disabled" })
                </td>
            }
        </tr>
        <tr>
            <td>
                &nbsp;
            </td>
        </tr>

        <tr>
            <td>
                @Html.Label("Inserisci danni")

            </td>
            <td>
                @if (ViewBag.ErrMess == "" || ViewBag.ErrMess == "Sbloccato")
                {
                    @Html.CheckBox("isDamaged", false, new { @onchange = "submitform();" })
                }
                else
                {
                    @Html.CheckBox("isDamaged", false, new { disabled = "disabled" })


                }
            </td>
            @if (@ViewBag.HasDanni == "Perizia GOOD")
            {
            <tr style="color:seagreen">
                <td>@ViewBag.HasDanni</td>
            </tr>
        }
        else
        {
            <tr style="color:red">
                <td>@ViewBag.HasDanni</td>
            </tr>
        }

            <tr>
                <td>
                    @Html.Label("Note:")

                </td>
                <td>
                    @Html.TextArea("Annotazioni", item4[0].Note)


                </td>

        </table>


        <br />
        <div>
            <table width="50%">
                <tr>
                    <td>
                        @Html.ActionLink("Inserisci foto", "ScattaFoto", "Documenti", new
                           {
                               myIDPerizia = item4[0].ID,
                               IDPerito = ViewBag.IDPerito,
                               IDSpedizione = ViewBag.IDSpedizione,
                               IDMeteo = ViewBag.IDMeteo,
                               IDTP = ViewBag.IDTP,
                               aIDTrasportatore = ViewBag.aIDTrasportatore,
                               aIDTipoRotabile = ViewBag.aIDTipoRotabile,
                               aIDModelloCasa = ViewBag.aIDModelloCasa,
                               ErrMess = ViewBag.ErrMess
                           }, new { @class = "photoImg" }) &nbsp;@ViewBag.NumFoto
                    </td>
                    
                    <td>
                        @Html.ActionLink("Inserisci PDF", "ScattaPDF", "Documenti", new
                                  {
                                      myIDPerizia = item4[0].ID,
                                      IDPerito = ViewBag.IDPerito,
                                      IDSpedizione = ViewBag.IDSpedizione,
                                      IDMeteo = ViewBag.IDMeteo,
                                      IDTP = ViewBag.IDTP,
                                      aIDTrasportatore = ViewBag.aIDTrasportatore,
                                      aIDTipoRotabile = ViewBag.aIDTipoRotabile,
                                      aIDModelloCasa = ViewBag.aIDModelloCasa
                                  }, new { @class = "pdfImg" }) &nbsp;@ViewBag.NumPDF
                            </td>
                </tr>
                
                
            </table>

</div>
        <div>
            <br />
        </div>
        <div>
            <button type="submit" class="btn btn-success custom">Conferma</button> &nbsp;&nbsp;&nbsp;
            @if (ViewBag.ErrMess == "" || ViewBag.ErrMess == "Sbloccato")
            {
                @Html.ActionLink("Termina", "InputTelaio", new
                   {
                       IDPerito = ViewBag.IDPerito,
                       IDSpedizione = ViewBag.IDSpedizione,
                       IDMeteo = ViewBag.IDMeteo,
                       IDTP = ViewBag.IDTP,
                   }, new { @class = "btn btn-danger custom" })
            }
            else
            {
                @Html.ActionLink("Termina", "InputTelaio", new
                   {
                       IDPerito = ViewBag.IDPerito,
                       IDSpedizione = ViewBag.IDSpedizione,
                       IDMeteo = ViewBag.IDMeteo,
                       IDTP = ViewBag.IDTP,
                   }, new { @class = "btn btn-danger custom disabled" })}
        </div>
    }
</div>

<br />

<div>
    @*@Html.ActionLink("Esci", "Index", null, new { @class = "btn btn-danger custom" })*@
</div>

<script>
    function InputToUpper(obj) {
        if (obj.value != "") {
            obj.value = obj.value.toUpperCase();
        }
    }
</script>


<script>
    $(document).ready(function () {
        $('.selectpicker').selectpicker({
            liveSearch: true,
            showSubtext: true
        });
    });
</script>
<script>
    function submitform() {
        $('form').submit();
    }
</script>